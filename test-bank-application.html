<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>JMA Motorcycle Sales Inc. | Motorcycle Financing</title>
  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;500;600;700&display=swap" rel="stylesheet" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css" />
  <script src="https://cdn.tailwindcss.com"></script>

  <style>
    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background: #f9f9f9;
      margin: 0;
      padding: 0;
      display: flex;
      flex-direction: column;
      align-items: center;
      min-height: 100vh;
      -webkit-font-smoothing: antialiased;
      -moz-osx-font-smoothing: grayscale;
    }
    h1 {
      margin-top: 20px;
      color: #222;
      user-select: none;
    }
    .banks {
      display: flex;
      flex-wrap: wrap;
      justify-content: center;
      margin: 20px;
      gap: 20px;
      max-width: 1000px;
    }
    .bank-card {
      width: 160px;
      cursor: pointer;
      text-align: center;
      border-radius: 10px;
      background: white;
      box-shadow: 0 2px 10px rgba(0,0,0,0.1);
      transition: transform 0.2s ease;
      user-select: none;
    }
    .bank-card:hover {
      transform: scale(1.05);
      box-shadow: 0 4px 15px rgba(0,0,0,0.15);
    }
    .bank-card img {
      width: 100%;
      height: 100px;
      object-fit: contain;
      border-bottom: 1px solid #eee;
      border-radius: 10px 10px 0 0;
      background: #fff;
      padding: 12px;
      pointer-events: none;
    }
    .bank-card p {
      margin: 10px 0;
      font-weight: 600;
      color: #333;
      font-size: 0.9rem;
      padding: 0 5px;
    }
    /* Form overlay */
    #formOverlay {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: rgba(0,0,0,0.65);
      display: none;
      justify-content: center;
      align-items: center;
      z-index: 1000;
      padding: 10px;
      overflow: auto;
      -webkit-overflow-scrolling: touch;
    }
    #formOverlay.active {
      display: flex;
    }
    .form-container {
      background: white;
      border-radius: 12px;
      max-width: 90vw;
      max-height: 90vh;
      width: 550px;
      padding: 30px 35px;
      box-shadow: 0 8px 25px rgba(0,0,0,0.3);
      overflow-y: auto;
      position: relative;
      display: flex;
      flex-direction: column;
    }
    .form-container h2 {
      margin-top: 0;
      margin-bottom: 25px;
      color: #111;
      text-align: center;
      font-family: 'Segoe UI Semibold', Tahoma, Geneva, Verdana, sans-serif;
      user-select: none;
    }
    .form-group {
      margin-bottom: 16px;
      display: flex;
      flex-direction: column;
    }
    label {
      font-weight: 600;
      margin-bottom: 8px;
      color: #444;
      user-select: none;
    }
    input[type="text"],
    input[type="email"],
    input[type="tel"],
    select,
    input[type="number"],
    input[type="date"] {
      padding: 11px 14px;
      border: 1.8px solid #bbb;
      border-radius: 7px;
      font-size: 1rem;
      transition: border-color 0.3s ease;
      font-family: inherit;
    }
    input[type="text"]:focus,
    input[type="email"]:focus,
    input[type="tel"]:focus,
    select:focus,
    input[type="number"]:focus,
    input[type="date"]:focus {
      border-color: #0052cc;
      outline: none;
    }
    button.submit-btn {
      margin-top: auto;
      padding: 14px;
      background: #0052cc;
      border: none;
      border-radius: 9px;
      color: white;
      font-size: 1.15rem;
      font-weight: 700;
      cursor: pointer;
      transition: background-color 0.3s ease;
      user-select: none;
    }
    button.submit-btn:hover:not(:disabled) {
      background: #003d99;
    }
    button.submit-btn:disabled {
      background: #77a1de;
      cursor: not-allowed;
    }
    .close-btn {
      position: absolute;
      top: 15px;
      right: 20px;
      background: transparent;
      border: none;
      font-size: 2.2rem;
      font-weight: 700;
      cursor: pointer;
      color: #888;
      user-select: none;
      padding: 0;
      line-height: 1;
    }
    .close-btn:hover {
      color: #222;
    }
    .message {
      margin-top: 15px;
      font-weight: 600;
      text-align: center;
      min-height: 1.4em;
      user-select: none;
    }
    .file-input-wrapper {
      margin-top: 8px;
    }
    .file-input-label {
      display: block;
      padding: 11px 14px;
      background: #f0f7ff;
      border: 1.8px solid #bbb;
      border-radius: 7px;
      cursor: pointer;
      transition: all 0.3s;
      text-align: center;
    }
    .file-input-label:hover {
      background: #e1eeff;
      border-color: #0052cc;
    }
    .file-name {
      font-size: 0.9rem;
      margin-top: 5px;
      color: #666;
      text-align: center;
    }
    .file-preview {
      max-width: 100%;
      max-height: 150px;
      margin-top: 10px;
      display: none;
      border-radius: 5px;
      border: 1px solid #eee;
    }
    .progress-bar {
      height: 5px;
      background: #ddd;
      border-radius: 3px;
      margin-top: 10px;
      overflow: hidden;
      display: none;
    }
    .progress {
      height: 100%;
      background: #0052cc;
      width: 0%;
      transition: width 0.3s ease;
    }
    @media (max-width: 600px) {
      .form-container {
        width: 95vw;
        padding: 25px 20px;
      }
      .bank-card {
        width: 130px;
      }
      .bank-card img {
        height: 80px;
      }
      .bank-card p {
        font-size: 0.8rem;
      }
    }
    body {
      margin: 0;
    }
    .hero-bg {
      background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
      border-radius: 0 0 20px 20px;
      margin-bottom: 30px;
      width: 100%;
      padding: 30px 0;
    }
    .preview-container {
      display: flex;
      flex-direction: column;
      align-items: center;
      margin-top: 10px;
    }
    .id-required {
      font-size: 0.85rem;
      color: #666;
      margin-top: 5px;
      text-align: center;
    }
  </style>
</head>
<body class="font-montserrat bg-gray-50 text-gray-800 antialiased">
  <div class="fixed bottom-0 left-0 right-0 bg-blue-900 text-white text-sm p-4 flex flex-col md:flex-row items-center justify-between z-50 shadow-lg">
    <p class="max-w-xl mb-2 md:mb-0 md:mr-4">
      By clicking “Accept”, you agree to the storing of cookies on your device to enhance site navigation, analyze site usage, and assist in our marketing efforts. View our
      <a href="/privacy-policy" class="text-blue-300 hover:underline font-medium">Privacy Policy</a> for more information.
    </p>
    <a href="#" class="inline-block bg-blue-500 text-white px-6 py-2 rounded-full font-semibold hover:bg-blue-600 transition duration-300 ease-in-out shrink-0">ACCEPT</a>
  </div>
  
  <header class="max-w-8xl mx-auto px-4 sm:px-6 py-4 md:py-6 flex items-center justify-between bg-white shadow-sm sticky top-0 z-40 w-full">
    <a href="/" aria-label="JMA Motorcycle Philippines Home" class="flex items-center">
      <div class="bg-gray-200 border-2 border-dashed rounded-xl w-16 h-8 md:w-20 md:h-10 mr-3"></div>
      <span class="text-xl md:text-2xl font-bold text-gray-900">JMA Motorcycle | MAKE IT HAPPEN</span>
    </a>
    <nav class="hidden md:flex space-x-6 lg:space-x-8">
      <a href="/" class="text-gray-600 hover:text-blue-600 transition duration-200">Home</a>
      <a href="/all-vehicles.html" class="text-gray-600 hover:text-blue-600 transition duration-200">Vehicles</a>
      <a href="/blog.html" class="text-gray-600 hover:text-blue-600 transition duration-200">Blog</a>
      <a href="/about" class="text-gray-600 hover:text-blue-600 transition duration-200">About</a>
      <a href="/contact" class="text-gray-600 hover:text-blue-600 transition duration-200">Contact</a>
    </nav>
    <button class="md:hidden text-gray-600 hover:text-blue-600 focus:outline-none">
      <i class="fas fa-bars text-xl"></i>
    </button>
    <div class="absolute top-full left-0 w-full bg-white shadow-lg md:hidden hidden">
      <nav class="flex flex-col space-y-2 px-4 py-3">
        <a href="/" class="block text-gray-800 hover:text-blue-600 py-1">Home</a>
        <a href="/all-vehicles.html" class="block text-gray-800 hover:text-blue-600 py-1">Vehicles</a>
        <a href="/blog.html" class="block text-gray-800 hover:text-blue-600 py-1">Blog</a>
        <a href="/about" class="block text-gray-800 hover:text-blue-600 py-1">About</a>
        <a href="/contact" class="block text-gray-800 hover:text-blue-600 py-1">Contact</a>
      </nav>
    </div>
  </header>

  <section class="hero-bg py-16 md:py-20 text-center px-4 w-full">
    <h1 class="text-3xl md:text-4xl font-bold text-gray-800 mb-6">Motorcycle Purchase Bank Applications</h1>
    <p class="text-gray-600 max-w-2xl mx-auto mb-8">Select a bank to begin your motorcycle financing application. All applications require a valid ID photo upload.</p>
    
    <div class="banks" role="list" aria-label="Select a bank">
      <div class="bank-card" data-bank="sbfinance" role="listitem" tabindex="0">
        <div class="bg-gray-200 border-2 border-dashed rounded-xl w-full h-24"></div>
        <p>sb finance</p>
      </div>
      <div class="bank-card" data-bank="stoNinoDeCebu" role="listitem" tabindex="0">
        <div class="bg-gray-200 border-2 border-dashed rounded-xl w-full h-24"></div>
        <p>Sto. Nino de Cebu FINANCE CORPORATION</p>
      </div>
      <div class="bank-card" data-bank="sumishoMotor" role="listitem" tabindex="0">
        <div class="bg-gray-200 border-2 border-dashed rounded-xl w-full h-24"></div>
        <p>Sumisho Motor Finance Corporation</p>
      </div>
      <div class="bank-card" data-bank="jpmorganChase" role="listitem" tabindex="0">
        <div class="bg-gray-200 border-2 border-dashed rounded-xl w-full h-24"></div>
        <p>JPMorgan Chase</p>
      </div>
      <div class="bank-card" data-bank="pncBank" role="listitem" tabindex="0">
        <div class="bg-gray-200 border-2 border-dashed rounded-xl w-full h-24"></div>
        <p>PNC Bank</p>
      </div>
    </div>

    <div id="formOverlay" role="dialog" aria-modal="true" aria-labelledby="formTitle">
      <div class="form-container">
        <button class="close-btn" title="Close form" aria-label="Close form">&times;</button>
        <h2 id="formTitle">Bank Application Form</h2>
        <form id="bankForm" novalidate autocomplete="off">
          <div id="formFieldsContainer"></div>
          <button type="submit" class="submit-btn">Submit Application</button>
          <div class="message" aria-live="polite"></div>
        </form>
      </div>
    </div>
  </section>

  <footer class="bg-gray-900 text-gray-300 py-12 px-4 w-full">
    <div class="max-w-8xl mx-auto grid grid-cols-1 md:grid-cols-4 gap-8">
      <div>
        <h3 class="text-lg font-bold text-white mb-4">JMA Motorcycle</h3>
        <p class="text-sm leading-relaxed">Bringing high-performance motorcycles to the Philippines. Experience the ride of a lifetime with our diverse range of models.</p>
      </div>
      <div>
        <h3 class="text-lg font-bold text-white mb-4">Quick Links</h3>
        <ul class="space-y-2 text-sm">
          <li><a href="/" class="hover:text-blue-500 transition duration-200">Home</a></li>
          <li><a href="/all-vehicles.html" class="hover:text-blue-500 transition duration-200">Vehicles</a></li>
          <li><a href="/blog.html" class="hover:text-blue-500 transition duration-200">Blog</a></li>
          <li><a href="/about" class="hover:text-blue-500 transition duration-200">About Us</a></li>
          <li><a href="/contact" class="hover:text-blue-500 transition duration-200">Contact</a></li>
        </ul>
      </div>
      <div>
        <h3 class="text-lg font-bold text-white mb-4">Legal</h3>
        <ul class="space-y-2 text-sm">
          <li><a href="/privacy-policy" class="hover:text-blue-500 transition duration-200">Privacy Policy</a></li>
          <li><a href="/terms-of-service" class="hover:text-blue-500 transition duration-200">Terms of Service</a></li>
        </ul>
      </div>
      <div>
        <h3 class="text-lg font-bold text-white mb-4">Connect</h3>
        <div class="flex space-x-4 text-xl">
          <a href="#" class="hover:text-blue-500 transition duration-200" aria-label="Facebook"><i class="fab fa-facebook-square"></i></a>
          <a href="#" class="hover:text-blue-500 transition duration-200" aria-label="Instagram"><i class="fab fa-instagram-square"></i></a>
          <a href="#" class="hover:text-blue-500 transition duration-200" aria-label="Twitter"><i class="fab fa-twitter-square"></i></a>
          <a href="#" class="hover:text-blue-500 transition duration-200" aria-label="YouTube"><i class="fab fa-youtube-square"></i></a>
        </div>
        <p class="mt-4 text-sm">&copy; 2025 JMA Motorcycle Philippines. All rights reserved.</p>
      </div>
    </div>
    <div class="text-center mt-8 text-gray-500 text-sm">
      <p>Proudly serving the Philippine riding community.</p>
    </div>
  </footer>

  <!-- Firebase SDKs -->
  <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-firestore-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-storage-compat.js"></script>

  <script>
    // Firebase configuration
    const firebaseConfig = {
    apiKey: " ",
    authDomain: "jma-motorcycles-sales-inc.firebaseapp.com",
    projectId: "jma-motorcycles-sales-inc",
    storageBucket: "jma-motorcycles-sales-inc.firebasestorage.app",
    messagingSenderId: "326225043486",
    appId: "1:326225043486:web:c72145ea9cf410be1f4e0f",
    measurementId: "G-2NJVW60VDG"
  };

    // Initialize Firebase
    firebase.initializeApp(firebaseConfig);
    const db = firebase.firestore();
    const storage = firebase.storage();

    // Bank form field definitions
    const banks = {
      sbfinance: {
        displayName: "sb finance",
        collection: "sbfinanceApplications",
        fields: [
          { label: "Full Name", name: "fullName", type: "text", required: true, placeholder: "Your full name" },
          { label: "Email Address", name: "email", type: "email", required: true, placeholder: "example@email.com" },
          { label: "Phone Number", name: "phone", type: "tel", required: true, placeholder: "+1234567890", pattern: "[0-9+()\\- ]{7,20}" },
          { label: "Address", name: "address", type: "text", required: true, placeholder: "Your street address" },
          { label: "Social Security Number", name: "ssn", type: "text", required: true, placeholder: "XXX-XX-XXXX", pattern: "\\d{3}-\\d{2}-\\d{4}" },
          { label: "Motorcycle Model", name: "motorcycleModel", type: "select", required: true,
            options: ["Harley-Davidson Street 750","Yamaha YZF-R3","Kawasaki Ninja 400","Honda CB500F","Suzuki GSX250R"]
          },
          { label: "Upload Valid ID Photo", name: "idPhoto", type: "file", required: true, accept: "image/*" }
        ]
      },
      stoNinoDeCebu: {
        displayName: "Sto. Nino de Cebu FINANCE CORPORATION",
        collection: "stoNinoDeCebuApplications",
        fields: [
          { label: "Applicant Name", name: "fullName", type: "text", required: true, placeholder: "Your full name" },
          { label: "Email", name: "email", type: "email", required: true, placeholder: "example@email.com" },
          { label: "Phone", name: "phone", type: "tel", required: true, placeholder: "(123) 456-7890", pattern: "[0-9+()\\- ]{7,20}" },
          { label: "Current Employer", name: "employer", type: "text", required: true, placeholder: "Employer name" },
          { label: "Annual Income ($)", name: "income", type: "number", required: true, placeholder: "Income amount", min: 0 },
          { label: "Preferred Motorcycle Model", name: "motorcycleModel", type: "select", required: true,
            options: ["Harley-Davidson Street 750","Yamaha YZF-R3","Kawasaki Ninja 400","Honda CB500F","Suzuki GSX250R"]
          },
          { label: "Upload Valid ID Photo", name: "idPhoto", type: "file", required: true, accept: "image/*" }
        ]
      },
      sumishoMotor: {
        displayName: "Sumisho Motor Finance Corporation",
        collection: "sumishoMotorApplications",
        fields: [
          { label: "Name", name: "fullName", type: "text", required: true, placeholder: "Full name" },
          { label: "Email", name: "email", type: "email", required: true, placeholder: "example@example.com" },
          { label: "Phone Number", name: "phone", type: "tel", required: true, placeholder: "Phone number", pattern: "[0-9+()\\- ]{7,20}" },
          { label: "Date of Birth", name: "dob", type: "date", required: true },
          { label: "Residential Address", name: "address", type: "text", required: true, placeholder: "Your address" },
          { label: "Motorcycle Model", name: "motorcycleModel", type: "select", required: true,
            options: ["Harley-Davidson Street 750","Yamaha YZF-R3","Kawasaki Ninja 400","Honda CB500F","Suzuki GSX250R"]
          },
          { label: "Upload Valid ID Photo", name: "idPhoto", type: "file", required: true, accept: "image/*" }
        ]
      },
      jpmorganChase: {
        displayName: "JPMorgan Chase",
        collection: "jpmorganChaseApplications",
        fields: [
          { label: "Applicant Full Name", name: "fullName", type: "text", required: true, placeholder: "Full name" },
          { label: "Contact Email", name: "email", type: "email", required: true, placeholder: "email@example.com" },
          { label: "Phone", name: "phone", type: "tel", required: true, placeholder: "Phone number", pattern: "[0-9+()\\- ]{7,20}" },
          { label: "Employer Name", name: "employer", type: "text", required: true, placeholder: "Employer" },
          { label: "Monthly Income ($)", name: "monthlyIncome", type: "number", required: true, min: 0, placeholder: "Amount" },
          { label: "Motorcycle Selected", name: "motorcycleModel", type: "select", required: true,
            options: ["Harley-Davidson Street 750","Yamaha YZF-R3","Kawasaki Ninja 400","Honda CB500F","Suzuki GSX250R"]
          },
          { label: "Upload Valid ID Photo", name: "idPhoto", type: "file", required: true, accept: "image/*" }
        ]
      },
      pncBank: {
        displayName: "PNC Bank",
        collection: "pncBankApplications",
        fields: [
          { label: "Full Name", name: "fullName", type: "text", required: true, placeholder: "Full name" },
          { label: "Email Address", name: "email", type: "email", required: true, placeholder: "email@example.com" },
          { label: "Phone Number", name: "phone", type: "tel", required: true, placeholder: "+1-234-567-8901", pattern: "[0-9+()\\- ]{7,20}" },
          { label: "Address", name: "address", type: "text", required: true, placeholder: "Street address" },
          { label: "Down Payment Amount ($)", name: "downPayment", type: "number", required: true, min: 0, placeholder: "Amount" },
          { label: "Preferred Motorcycle Model", name: "motorcycleModel", type: "select", required: true,
            options: ["Harley-Davidson Street 750","Yamaha YZF-R3","Kawasaki Ninja 400","Honda CB500F","Suzuki GSX250R"]
          },
          { label: "Upload Valid ID Photo", name: "idPhoto", type: "file", required: true, accept: "image/*" }
        ]
      }
    };

    // Elements
    const bankCards = document.querySelectorAll('.bank-card');
    const formOverlay = document.getElementById('formOverlay');
    const formTitle = document.getElementById('formTitle');
    const form = document.getElementById('bankForm');
    const formFieldsContainer = document.getElementById('formFieldsContainer');
    const closeBtn = formOverlay.querySelector('.close-btn');
    const messageDiv = form.querySelector('.message');
    const submitBtn = form.querySelector('button[type="submit"]');

    let selectedBank = null;

    // Event listeners for bank cards
    bankCards.forEach(card => {
      card.addEventListener('click', () => openBankForm(card));
      card.addEventListener('keydown', (e) => {
        if(e.key === "Enter" || e.key === " ") {
          e.preventDefault();
          openBankForm(card);
        }
      });
    });

    // Open bank form
    function openBankForm(card) {
      selectedBank = card.getAttribute('data-bank');
      if (!banks[selectedBank]) {
        alert('Invalid bank selection');
        return;
      }
      const bank = banks[selectedBank];
      formTitle.textContent = bank.displayName + " - Motorcycle Application";
      messageDiv.textContent = '';
      formFieldsContainer.innerHTML = '';
      buildFormFields(bank.fields);
      form.reset();
      formOverlay.classList.add('active');
      
      // Focus first input
      setTimeout(() => {
        const firstInput = formFieldsContainer.querySelector('input, select');
        if (firstInput) firstInput.focus();
      }, 150);
    }

    // Build form fields
    function buildFormFields(fields) {
      fields.forEach(field => {
        const formGroup = document.createElement('div');
        formGroup.classList.add('form-group');
        
        const label = document.createElement('label');
        label.setAttribute('for', field.name);
        label.textContent = field.label + (field.required ? ' *' : '');
        formGroup.appendChild(label);
        
        if (field.type === 'select') {
          const select = document.createElement('select');
          select.name = field.name;
          select.id = field.name;
          if (field.required) select.required = true;
          
          const defaultOption = document.createElement('option');
          defaultOption.value = '';
          defaultOption.textContent = 'Select option';
          defaultOption.disabled = true;
          defaultOption.selected = true;
          select.appendChild(defaultOption);
          
          field.options.forEach(opt => {
            const option = document.createElement('option');
            option.value = opt;
            option.textContent = opt;
            select.appendChild(option);
          });
          
          formGroup.appendChild(select);
        } 
        else if (field.type === 'file') {
          const input = document.createElement('input');
          input.type = 'file';
          input.name = field.name;
          input.id = field.name;
          input.accept = field.accept || 'image/*';
          input.style.display = 'none';
          if (field.required) input.required = true;
          
          const customLabel = document.createElement('label');
          customLabel.htmlFor = field.name;
          customLabel.classList.add('file-input-label');
          customLabel.innerHTML = `<i class="fas fa-upload mr-2"></i> Choose File`;
          
          const fileNameDisplay = document.createElement('div');
          fileNameDisplay.classList.add('file-name');
          fileNameDisplay.textContent = 'No file selected';
          
          const previewImg = document.createElement('img');
          previewImg.classList.add('file-preview');
          
          const progressBar = document.createElement('div');
          progressBar.classList.add('progress-bar');
          progressBar.innerHTML = '<div class="progress"></div>';
          
          const idInfo = document.createElement('div');
          idInfo.classList.add('id-required');
          idInfo.textContent = 'Accepted: Driver\'s License, Passport, or National ID';
          
          input.addEventListener('change', function() {
            if (this.files.length > 0) {
              fileNameDisplay.textContent = this.files[0].name;
              
              // Show preview
              const reader = new FileReader();
              reader.onload = function(e) {
                previewImg.src = e.target.result;
                previewImg.style.display = 'block';
              }
              reader.readAsDataURL(this.files[0]);
            } else {
              fileNameDisplay.textContent = 'No file selected';
              previewImg.style.display = 'none';
            }
          });
          
          const previewContainer = document.createElement('div');
          previewContainer.classList.add('preview-container');
          previewContainer.appendChild(previewImg);
          previewContainer.appendChild(progressBar);
          
          formGroup.appendChild(customLabel);
          formGroup.appendChild(input);
          formGroup.appendChild(fileNameDisplay);
          formGroup.appendChild(previewContainer);
          formGroup.appendChild(idInfo);
        } 
        else {
          const input = document.createElement('input');
          input.type = field.type;
          input.name = field.name;
          input.id = field.name;
          if (field.required) input.required = true;
          if (field.placeholder) input.placeholder = field.placeholder;
          if (field.pattern) input.pattern = field.pattern;
          if (field.min !== undefined) input.min = field.min;
          if (field.max !== undefined) input.max = field.max;
          
          formGroup.appendChild(input);
        }
        
        formFieldsContainer.appendChild(formGroup);
      });
    }

    // Close form
    closeBtn.addEventListener('click', closeForm);
    formOverlay.addEventListener('click', (e) => {
      if (e.target === formOverlay) closeForm();
    });

    function closeForm() {
      formOverlay.classList.remove('active');
      selectedBank = null;
      formFieldsContainer.innerHTML = '';
      form.reset();
      messageDiv.textContent = '';
    }

    // Form submission
    form.addEventListener('submit', async (e) => {
      e.preventDefault();
      if (!selectedBank || !banks[selectedBank]) {
        showMessage('Invalid bank selection', 'red');
        return;
      }

      if (!form.checkValidity()) {
        form.reportValidity();
        return;
      }

      const bank = banks[selectedBank];
      const formData = {};
      let idPhotoUrl = '';
      
      // Disable submit button
      submitBtn.disabled = true;
      
      // Get file input
      const fileInput = form.querySelector('input[type="file"]');
      if (fileInput && fileInput.files.length > 0) {
        const file = fileInput.files[0];
        const storageRef = storage.ref();
        const filePath = `id_photos/${selectedBank}/${Date.now()}_${file.name}`;
        const fileRef = storageRef.child(filePath);
        
        // Show progress bar
        const progressBar = form.querySelector('.progress-bar');
        const progress = form.querySelector('.progress');
        progressBar.style.display = 'block';
        progress.style.width = '0%';
        
        showMessage('Uploading ID photo...', 'black');
        
        try {
          // Upload file
          const uploadTask = fileRef.put(file);
          
          // Listen for upload progress
          uploadTask.on('state_changed', 
            (snapshot) => {
              const progressPercent = (snapshot.bytesTransferred / snapshot.totalBytes) * 100;
              progress.style.width = `${progressPercent}%`;
            },
            (error) => {
              console.error('Upload error:', error);
              showMessage(`Upload failed: ${error.message}`, 'red');
              submitBtn.disabled = false;
              progressBar.style.display = 'none';
            },
            async () => {
              // Get download URL
              idPhotoUrl = await uploadTask.snapshot.ref.getDownloadURL();
              formData.idPhotoUrl = idPhotoUrl;
              
              // Hide progress bar
              progressBar.style.display = 'none';
              
              // Continue with form submission
              await submitFormData(bank, formData);
            }
          );
        } catch (error) {
          console.error('Upload error:', error);
          showMessage(`Upload failed: ${error.message}`, 'red');
          submitBtn.disabled = false;
        }
      } else {
        // No file to upload, submit form data
        await submitFormData(bank, formData);
      }
    });

    // Submit form data to Firestore
    async function submitFormData(bank, formData) {
      try {
        // Collect other form data (skip file field)
        bank.fields.forEach(field => {
          if (field.type === 'file') return;
          
          let element = form.elements[field.name];
          if (!element) return;
          
          formData[field.name] = element.value.trim();
        });
        
        formData.submittedAt = new Date().toISOString();
        formData.bank = bank.displayName;
        
        showMessage('Submitting application...', 'black');
        
        // Write to Firestore
        await db.collection(bank.collection).add(formData);
        
        showMessage('Application submitted successfully! Thank you.', 'green');
        
        // Reset form and close after delay
        setTimeout(() => {
          closeForm();
          submitBtn.disabled = false;
        }, 2800);
      } catch (error) {
        console.error('Firestore submission error:', error);
        showMessage(`Submission failed: ${error.message}`, 'red');
        submitBtn.disabled = false;
      }
    }

    // Helper function to show messages
    function showMessage(text, color) {
      messageDiv.style.color = color;
      messageDiv.textContent = text;
    }
  </script>
</body>
</html>